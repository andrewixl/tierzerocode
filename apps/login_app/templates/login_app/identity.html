{% extends 'main/base.html' %}
{% load static %}
  {% block content %}
			<main class="content">
				<div class="container-fluid p-0">

					<div class="row mb-2 mb-xl-3">
						{% if messages %}
							{% for message in messages %}
							<div class="alert alert-{{message.tags}} alert-dismissible" role="alert">
								<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
								<div class="alert-message">
									<strong>{{message|safe}}</strong>
								</div>
							</div>
							{% endfor %}
						{% endif %}
						<div class="col-auto d-none d-sm-block">
							<h3>User Management</h3>
						</div>
						<div class="col-auto ms-auto mt-n1">
							<nav aria-label="breadcrumb">
								<ol class="breadcrumb bg-transparent p-0 mt-1 mb-0">
									<!-- <li class="breadcrumb-item"><a href="/delete/{{change.id}}"><button class="btn btn-danger">Delete</button></a></li> -->
									<!-- Modal Start -->
									<button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#createUserModal" data-bs-backdrop="static" data-bs-keyboard="false" style="margin-right: 20px;">
										Add User
									</button>
									<div class="modal fade" id="createUserModal" tabindex="-1" role="dialog" aria-hidden="true">
										<div class="modal-dialog modal-md" role="document">
											<div class="modal-content">
												<div class="m-sm-4">
													<div class="text-center">
														<h3>Create New User</h3>
													</div>
													<form action='/identity/accountcreation' method='post'>
														{% csrf_token %}
														<div class="mb-3">
															<label class="form-label">First Name</label>
															<input class="form-control form-control-lg" type="text" name="firstName" placeholder="Enter your First Name" />
														</div>
														<div class="mb-3">
															<label class="form-label">Last Name</label>
															<input class="form-control form-control-lg" type="text" name="lastName" placeholder="Enter your Last Name" />
														</div>
														<div class="mb-3">
															<label class="form-label">Email</label>
															<input class="form-control form-control-lg" type="email" name="email" placeholder="Enter your Email" />
														</div>
														<!-- <div class="mb-3">
															<label class="form-label">Password</label>
															<input class="form-control form-control-lg" type="password" name="password" placeholder="Enter your Password" />
														</div>
														<div class="mb-3">
															<label class="form-label">Confirm Password</label>
															<input class="form-control form-control-lg" type="password" name="c_password" placeholder="Enter your Password" />
														</div> -->
														<label class="form-check">
															<input class="form-check-input" type="checkbox" value="sso-user" name="sso-user">
															<span class="form-check-label">
																SSO User?
															</span>
														</label>

												</div>
												<div class="modal-footer">
													<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
													<button type="submit" class="btn btn-success">Create</button>
												</div>
												</form>
											</div>
										</div>
									</div>
									<!-- Modal End -->
								</ol>
							</nav>
						</div>
					</div>

					<div class="row">
						<div class="col-12">
							<div class="card">
								<div class="card-body">
									<table id="table" class="table table-striped" style="width:100%">
										<thead>
											<tr>
												<th>Name</th>
												<th>Email</th>
												<th>Permission</th>
												<th>Provisioning Type</th>
												<th>Last Login</th>
												<th>Manage User</th>
											</tr>
										</thead>
										<tbody>
											{% for user in users %}
											<tr>
												<td>{{user.first_name}} {{user.last_name}}</td>
												<td>{{user.email}}</td>
												{% if user.is_active == False %}
												<td>Suspended</td>
												{% else %}
													{% if user.is_superuser %}
													<td>Administrator</td>
													{% else %}
													<td>User</td>
													{% endif %}
												{% endif %}
												{% if user.has_usable_password %}
												<td>Local</td>
												{% else %}
												<td>Microsoft Entra ID</td>
												{% endif %}
												<td>{{user.last_login}}</td>
												<td>

												{% if user.is_active == False %}
													<!-- Modal Start -->
													<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-backdrop="static" data-bs-keyboard="false" data-bs-target="#modal-activate-{{user.id}}">
														Activate 
													</button>
													<div class="modal fade" id="modal-activate-{{user.id}}" tabindex="-1" role="dialog" aria-hidden="true">
														<div class="modal-dialog modal-sm" role="document">
															<div class="modal-content">
																<div class="modal-header">
																	<h5 class="modal-title">Confirm User Account Activation</h5>
																	<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
																</div>
																<div class="modal-body m-3">
																	<h4 class="mb-0" style="text-align: center;">You are about to Activate <strong>{{user.first_name}} {{user.last_name}}'s</strong> Account</h4>
																</div>
																<div class="modal-footer">
																	<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
																	<a href="/identity/activateuser/{{user.id}}"><button type="button" class="btn btn-success">Activate</button></a>
																</div>
															</div>
														</div>
													</div>
													<!-- Modal End -->
												{% else %}
													<!-- Modal Start -->
													<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-backdrop="static" data-bs-keyboard="false" data-bs-target="#modal-suspend-{{user.id}}">
														Suspend
													</button>
													<div class="modal fade" id="modal-suspend-{{user.id}}" tabindex="-1" role="dialog" aria-hidden="true">
														<div class="modal-dialog modal-sm" role="document">
															<div class="modal-content">
																<div class="modal-header">
																	<h5 class="modal-title">Confirm User Account Suspension</h5>
																	<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
																</div>
																<div class="modal-body m-3">
																	<h4 class="mb-0" style="text-align: center;">You are about to Suspend <strong>{{user.first_name}} {{user.last_name}}'s</strong> Account</h4>
																</div>
																<div class="modal-footer">
																	<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
																	<a href="/identity/suspenduser/{{user.id}}"><button type="button" class="btn btn-danger">Suspend</button></a>
																</div>
															</div>
														</div>
													</div>
													<!-- Modal End -->
												{% endif %}
													<!-- Modal Start -->
													<button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-backdrop="static" data-bs-keyboard="false" data-bs-target="#modal-delete-{{user.id}}">
														Delete
													</button>
													<div class="modal fade" id="modal-delete-{{user.id}}" tabindex="-1" role="dialog" aria-hidden="true">
														<div class="modal-dialog modal-sm" role="document">
															<div class="modal-content">
																<div class="modal-header">
																	<h5 class="modal-title">Confirm User Account Deletion</h5>
																	<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
																</div>
																<div class="modal-body m-3">
																	<h4 class="mb-0" style="text-align: center;">You are about to Delete <strong>{{user.first_name}} {{user.last_name}}'s</strong> Account</h4>
																</div>
																<div class="modal-footer">
																	<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
																	<a href="/identity/deleteuser/{{user.id}}"><button type="button" class="btn btn-danger">Delete</button></a>
																</div>
															</div>
														</div>
													</div>
													<!-- Modal End -->
												</td>
											</tr>
											{% endfor %}
										</tbody>
									</table>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="container-fluid p-0">
					<!-- <a href="#" class="btn btn-primary float-end mt-n1"><i class="fas fa-plus"></i> Submit Integration Request</a> -->
					<div class="mb-3">
						<h1 class="h3 d-inline align-middle">SSO Integrations</h1>
						<!-- <a class="badge bg-primary ms-2" href="https://documentation.tierzerocode.com/integratons/"
							target="_blank">Documentation<i class="fas fa-fw fa-external-link-alt"></i></a> -->
					</div>
		
					<div class="row">
						<!-- ---------------------------- START SSO INTEGRATION CARD ---------------------------- -->
						{% for integrationStatus in integrationStatuses %}
						<div class="col-12 col-md-6 col-lg-3">
							<div class="card">
								<img class="card-img-top" src="{% static integrationStatus.1 %}" alt="{{integrationStatus.0}}">
								<div class="card-header px-4 pt-4">
									<div class="card-actions float-end">
										<div class="dropdown position-relative">
											<a href="#" data-bs-toggle="dropdown" data-bs-display="static">
												<i class="align-middle" data-feather="more-horizontal"></i>
											</a>
		
											<div class="dropdown-menu dropdown-menu-end">
												{% if True == integrationStatus.2 %}
												<a class="dropdown-item" href="/identity/disable-sso-integration/{{integrationStatus.4}}">Disable Integration</a>
												<a class="dropdown-item" data-bs-toggle="modal" data-bs-target="#{{integrationStatus.0.split|join:'_'}}_modal" href="#">Configure Integration</a>
												<!-- {% if True == integrationStatus.3 %}
												<a class="dropdown-item" href="/sync-{{integrationStatus.0.split|join:'-'}}-devices">Test Integration</a>
												{% endif %} -->
												{% elif False == integrationStatus.2 %}
												<a class="dropdown-item" href="/identity/enable-sso-integration/{{integrationStatus.4}}">Enable Integration</a>
												{% endif %}
											</div>
										</div>
									</div>
									<h5 class="card-title mb-0">{{integrationStatus.0}}</h5>
									{% if True == integrationStatus.2 %}
									<div class="badge bg-success my-2">Enabled</div>
									{% elif False == integrationStatus.2 %}
									<div class="badge bg-danger my-2">Disabled</div>
									{% endif %}
									{% if True == integrationStatus.3 %}
									<div class="badge bg-success my-2">Configured</div>
									{% elif False == integrationStatus.3 %}
									<div class="badge bg-danger my-2">Not Configured</div>
									{% endif %}
		
									<p>Last Test: {{integrationStatus.8}}</p>
								</div>
								<!-- BEGIN primary modal -->
								<div class="modal fade" id="{{integrationStatus.0.split|join:'_'}}_modal" tabindex="-1" role="dialog" aria-hidden="true">
									<div class="modal-dialog modal-dialog-centered" role="document">
										<div class="modal-content">
											<div class="modal-header">
												<h5 class="modal-title">Configure {{integrationStatus.0}} Integration</h5>
												<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
											</div>
											<div class="modal-body m-3">
												<form action="/identity/update-sso-integration/{{integrationStatus.4}}" method="post">
													{% csrf_token %}
													<div class="mb-3">
														<label class="form-label">Client ID <span style="color: red;">*</span></label>
														<input type="text" class="form-control" name="client_id" placeholder="Client ID" value="{{integrationStatus.5}}">
													</div>
													<div class="mb-3">
														<label class="form-label">Client Secret <span style="color: red;">*</span></label>
														<input type="password" class="form-control" name="client_secret" placeholder="Client Secret" required>
													</div>
													<div class="mb-3">
														<label class="form-label">Tenant ID <span style="color: red;">*</span></label>
														<input type="text" class="form-control" name="tenant_id" placeholder="Tenant ID" value="{{integrationStatus.6}}">
													</div>
													<div class="mb-3">
														<label class="form-label">Tenant Domain <span style="color: red;">*</span></label>
														<input type="text" class="form-control" name="tenant_domain" placeholder="example.com" value="{{integrationStatus.7}}">
													</div>
											</div>
											<div class="modal-footer">
												<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
												<button type="submit" class="btn btn-primary">Save changes</button>
											</div>
												</form>
										</div>
									</div>
								</div>
								<!-- END primary modal -->
								<!-- <div class="card-body px-4 pt-2">
									<p>Last Synced: NULL</p>
									<p>Last Sync Status: SUCCESS</p>
								</div> -->
							</div>
						</div>
						{% endfor %}
						<!-- ---------------------------- END SSO INTEGRATION CARD ---------------------------- -->
					</div>
				</div>
			</main>
			{% endblock %}