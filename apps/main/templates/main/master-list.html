{% extends 'main/base.html' %}
{% load static %}
  {% block content %}
			<main class="content">
				<div class="container-fluid p-0">

					<div class="mb-3">
						<h1 class="h3 d-inline align-middle">Master List of Endpoints</h1>
					</div>

					<div class="row">
						<div class="col-12">
							<div class="card">
								<div class="card-body">
									<!-- Filter Dropdown -->
									<div class="row mb-3">
										<div class="col-md-4">
										  <label for="os-platform-filter">Filter by OS Platform:</label>
										  <select id="os-platform-filter" class="form-control" multiple="multiple">
											{% for platform in os_platforms %}
											<option value="{{ platform }}">{{ platform }}</option>
											{% endfor %}
										  </select>
										</div>
										<div class="col-md-4">
											<label for="endpoint-type-filter">Filter by Endpoint Type:</label>
											<select id="endpoint-type-filter" class="form-control" multiple="multiple">
											  {% for endpoint in endpoint_types %}
											  <option value="{{ endpoint }}">{{ endpoint }}</option>
											  {% endfor %}
											</select>
										  </div>
										<div class="col-md-4">
										  <label for="compliance-filter">Filter by Compliance:</label>
										  <select id="compliance-filter" class="form-control">
											<option value="">All</option>
											<option value="True">Compliant</option>
											<option value="False">Non-compliant</option>
											<option value="None">Unknown</option>
										  </select>
										</div>
									</div>
									<table id="datatables-responsive" class="table table-striped" style="width:100%">
										<thead>
											<tr>
												<th>Hostname</th>
												<th>Compliance</th>
												<th>OS Platform</th>
												<th>Endpoint Type</th>
												{% for integration in enabled_integrations %}
													<th>{{integration.integration_type_short}}</th>
												{% endfor %}
											</tr>
										</thead>
										<tbody>
											{% for endpoint in endpoint_list %}
											<tr>
												
												{% for check in endpoint %}
													{% if check == True %}
														<!-- <td><i class="fa fa-check-circle text-success"></i></td> -->
														<td class="text-success">&#9989;</td>
													{% elif check == False %}
														<td class="text-danger">&#10060;</td>
													{% elif check == None %}
														<td class="text-secondary">&#x29B8;</td>
													{% else %}
														<td><a href="/device/{{check.id}}">{{check.hostname}}</a></td>
														<td>{{check.compliant}}</td>
														<td>{{check.osPlatform}}</td>
														<td>{{check.endpointType}}</td>
													{% endif %}
												{% endfor %}
											</tr>
											{% endfor %}
										</tbody>
									</table>
								</div>
							</div>
						</div>
					</div>

				</div>
			</main>
			{% endblock %}

			{% block extra_js %}
			<!-- Include jQuery first -->
			<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
			<!-- Include Select2 CSS and JS -->
			<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" rel="stylesheet" />
			<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.full.min.js"></script>
			<!-- Include DataTables CSS and JS -->
			<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.css">
			<script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
			<!-- Include DataTables Buttons extension CSS and JS -->
			<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/buttons/2.0.0/css/buttons.dataTables.min.css">
			<script src="https://cdn.datatables.net/buttons/2.0.0/js/dataTables.buttons.min.js"></script>
			<script src="https://cdn.datatables.net/buttons/2.0.0/js/buttons.html5.min.js"></script>
			<script src="https://cdn.datatables.net/buttons/2.0.0/js/buttons.print.min.js"></script>
			<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
			<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
			<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>


			<script>
				document.addEventListener("DOMContentLoaded", function() {
					// Initialize Select2 for multi-select dropdown
					$('#os-platform-filter').select2({
					placeholder: "Select OS Platform(s)",
					allowClear: true
					});
					$('#endpoint-type-filter').select2({
					placeholder: "Select Endpoint Type(s)",
					allowClear: true
					});
					// Datatables Responsive
					var table = $("#datatables-responsive").DataTable({
						responsive: true,
						dom: 'Bfrtip',
						buttons: [
							'excelHtml5',
							'pdfHtml5',
							'print'
						]
						// columnDefs: [
						// 	{
						// 		targets: 2, // Index of the hidden column
						// 		visible: false
						// 	}
						// ]
					});
					// Apply the filters
					function applyFilters() {
					var selectedPlatforms = $('#os-platform-filter').val();
					var selectedEndpointTypes = $('#endpoint-type-filter').val();
					var selectedCompliance = $('#compliance-filter').val();
					
					var platformRegex = selectedPlatforms ? selectedPlatforms.join('|') : '';
					var endpointTypeRegex = selectedEndpointTypes ? selectedEndpointTypes.join('|') : '';
					var complianceRegex = selectedCompliance ? selectedCompliance : '';

					table
						.column(3).search(endpointTypeRegex, true, false)
						.column(2).search(platformRegex, true, false)
						.column(1).search(complianceRegex, true, false)
						.draw();
    				}
					$('#os-platform-filter').on('change', applyFilters);
					$('#endpoint-type-filter').on('change', applyFilters);
					$('#compliance-filter').on('change', applyFilters);
				});
			</script>
			{% endblock %}	
</body>
</html>
